<!-- Mobile-first responsive layout -->
<div class="converter-container">
  <!-- Main Converter Section -->
  <div class="converter-section">
    <mat-card class="converter-card">
      <mat-card-header>
        <mat-icon mat-card-avatar style="color: #1976d2;">currency_exchange</mat-icon>
        <mat-card-title>Currency Converter</mat-card-title>
        <mat-card-subtitle>Real-time & historical exchange rates</mat-card-subtitle>
        <div style="margin-left: auto;">
          <mat-chip color="primary">
            <mat-icon style="margin-right: 4px;">flash_on</mat-icon>
            Live Rates
          </mat-chip>
        </div>
      </mat-card-header>
      
      <mat-divider></mat-divider>

      <mat-card-content style="flex: 1; overflow-y: auto;">
        <!-- Date Selection -->
        <div style="margin-bottom: 24px;">
          <mat-expansion-panel expanded="false" style="margin-bottom: 16px;">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon style="margin-right: 8px;">calendar_today</mat-icon>
                Historical Date (Optional)
              </mat-panel-title>
              <mat-panel-description *ngIf="selectedDate">
                {{selectedDate | date:'mediumDate'}}
              </mat-panel-description>
            </mat-expansion-panel-header>
            
            <div style="display: flex; gap: 16px; align-items: center;">
              <mat-form-field appearance="outline" style="flex: 1;">
                <mat-label>Select date for historical rates</mat-label>
                <input matInput 
                      [matDatepicker]="picker" 
                      [(ngModel)]="selectedDate"
                      (dateChange)="onDateChange()"
                      [max]="today" />
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <mat-hint>Leave empty for latest rates</mat-hint>
              </mat-form-field>
              
              <button mat-stroked-button 
                      color="warn" 
                      (click)="clearDate()"
                      [disabled]="!selectedDate">
                <mat-icon>clear</mat-icon>
                Clear
              </button>
            </div>
          </mat-expansion-panel>
        </div>

        <!-- From Currency -->
        <div style="margin-bottom: 24px;">
          <mat-card appearance="outlined" style="margin-bottom: 16px;">
            <mat-card-header>
              <mat-icon mat-card-avatar style="color: #1976d2;">arrow_downward</mat-icon>
              <mat-card-title>From Currency</mat-card-title>
              <mat-card-subtitle>Source Amount</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div style="display: flex; flex-direction: column; gap: 16px;">
                <mat-form-field appearance="outline">
                  <mat-label>Select Currency</mat-label>
                  <mat-select [(ngModel)]="fromCurrency" (selectionChange)="onCurrencyChange()">
                    <mat-option *ngFor="let currency of currencies" [value]="currency">
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span>{{getFlagEmoji(currency.code)}}</span>
                        <span style="font-weight: 500;">{{currency.code}}</span>
                        <span style="color: rgba(0,0,0,0.6);">{{currency.name}}</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>search</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Amount</mat-label>
                  <input matInput
                         appCurrencyInput
                         [(ngModel)]="amount"
                         (input)="onAmountChange()"
                         step="0.01"
                         min="0.01"
                         required />
                  <mat-icon matPrefix>attach_money</mat-icon>
                  <mat-error *ngIf="amount <= 0">Amount must be greater than 0</mat-error>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Swap Button -->
        <div style="display: flex; justify-content: center; margin: 24px 0;">
          <button mat-fab 
                  color="accent" 
                  (click)="swapCurrencies()"
                  matTooltip="Swap currencies">
            <mat-icon>swap_horiz</mat-icon>
          </button>
        </div>

        <!-- To Currency -->
        <div style="margin-bottom: 24px;">
          <mat-card appearance="outlined">
            <mat-card-header>
              <mat-icon mat-card-avatar style="color: #2e7d32;">arrow_upward</mat-icon>
              <mat-card-title>To Currency</mat-card-title>
              <mat-card-subtitle>Converted Amount</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div style="display: flex; flex-direction: column; gap: 16px;">
                <mat-form-field appearance="outline">
                  <mat-label>Select Currency</mat-label>
                  <mat-select [(ngModel)]="toCurrency" (selectionChange)="onCurrencyChange()">
                    <mat-option *ngFor="let currency of currencies" [value]="currency">
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span>{{getFlagEmoji(currency.code)}}</span>
                        <span style="font-weight: 500;">{{currency.code}}</span>
                        <span style="color: rgba(0,0,0,0.6);">{{currency.name}}</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>flag</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Converted Amount</mat-label>
                  <input matInput 
                        [value]="convertedAmount | number:'1.2-2'" 
                        readonly
                        placeholder="0.00" />
                  <mat-icon matPrefix>check_circle</mat-icon>
                  <mat-hint *ngIf="exchangeRate">
                    1 {{fromCurrency?.code}} = {{exchangeRate | number:'1.6-6'}} {{toCurrency?.code}}
                  </mat-hint>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Rate Display -->
        <mat-card *ngIf="exchangeRate > 0" color="primary" style="margin-bottom: 24px;">
          <mat-card-content>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <mat-icon style="color: white;">trending_up</mat-icon>
                <div>
                  <div style="font-size: 0.875rem; opacity: 0.9; color: white;">Current Exchange Rate</div>
                  <div style="font-size: 1.25rem; font-weight: 600; color: white; font-family: monospace;">
                    1 {{fromCurrency?.code}} = {{exchangeRate | number:'1.4-4'}} {{toCurrency?.code}}
                  </div>
                </div>
              </div>
              <div *ngIf="!selectedDate" style="display: flex; align-items: center; gap: 4px; color: rgba(255,255,255,0.9);">
                <mat-icon style="font-size: 16px;">schedule</mat-icon>
                <span>Updated just now</span>
              </div>
              <div *ngIf="selectedDate" style="display: flex; align-items: center; gap: 4px; color: rgba(255,255,255,0.9);">
                <mat-icon style="font-size: 16px;">history</mat-icon>
                <span>Historical rate</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Loader -->
        <div *ngIf="loading" style="display: flex; flex-direction: column; align-items: center; padding: 40px;">
          <mat-spinner [diameter]="40"></mat-spinner>
          <div style="margin-top: 16px; color: rgba(0,0,0,0.6);">Fetching exchange rates...</div>
        </div>

        <!-- Error Message -->
        <mat-card *ngIf="error" color="warn" appearance="outlined" style="margin-bottom: 24px;">
          <mat-card-content>
            <div style="display: flex; align-items: center; gap: 12px;">
              <mat-icon>error</mat-icon>
              <div>
                <div style="font-weight: 500; margin-bottom: 4px;">Conversion Error</div>
                <div style="font-size: 0.875rem;">{{error}}</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 16px; margin-top: 32px;">
          <button mat-raised-button 
                  color="primary" 
                  (click)="saveConversion()"
                  [disabled]="!canConvert || loading"
                  style="flex: 1;">
            <mat-icon>save</mat-icon>
            Save Conversion
          </button>
          <button mat-stroked-button 
                  color="basic"
                  (click)="resetForm()"
                  style="flex: 1;">
            <mat-icon>refresh</mat-icon>
            Reset
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- History Section -->
  <div class="history-section">
    <mat-card class="history-card">
      <mat-card-header>
        <mat-icon mat-card-avatar style="color: #7b1fa2;">history</mat-icon>
        <mat-card-title>Conversion History</mat-card-title>
        <mat-card-subtitle>{{conversionHistory.length}} records</mat-card-subtitle>
        <button mat-icon-button 
                color="warn" 
                (click)="clearHistory()"
                [disabled]="conversionHistory.length === 0"
                matTooltip="Clear all history"
                style="margin-left: auto;">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-header>
      
      <mat-divider></mat-divider>

      <mat-card-content style="flex: 1; overflow-y: auto; padding: 16px;">
        <mat-list *ngIf="conversionHistory.length > 0; else emptyHistory">
          <ng-container *ngFor="let record of conversionHistory; let i = index">
            <mat-list-item>
              <div style="width: 100%;">
                <!-- Main conversion info -->
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                  <div style="display: flex; align-items: baseline; gap: 4px;">
                    <span style="font-size: 1.125rem; font-weight: 600; color: #1976d2;">
                      {{record.amount | number:'1.2-2'}}
                    </span>
                    <span style="font-size: 0.875rem; color: rgba(0,0,0,0.6); background: #f5f5f5; padding: 2px 8px; border-radius: 12px;">
                      {{record.fromCurrency}}
                    </span>
                  </div>
                  <mat-icon style="color: rgba(0,0,0,0.4);">arrow_forward</mat-icon>
                  <div style="display: flex; align-items: baseline; gap: 4px;">
                    <span style="font-size: 1.125rem; font-weight: 600; color: #1976d2;">
                      {{record.convertedAmount | number:'1.2-2'}}
                    </span>
                    <span style="font-size: 0.875rem; color: rgba(0,0,0,0.6); background: #f5f5f5; padding: 2px 8px; border-radius: 12px;">
                      {{record.toCurrency}}
                    </span>
                  </div>
                </div>
                
                <!-- Details -->
                <div style="display: flex; flex-direction: column; gap: 4px; padding-left: 4px;">
                  <div style="display: flex; align-items: center; gap: 12px; font-size: 0.75rem; color: rgba(0,0,0,0.6);">
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <mat-icon style="font-size: 14px; height: 14px; width: 14px;">swap_vert</mat-icon>
                      <span>Rate: {{record.rate | number:'1.6-6'}}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <mat-icon style="font-size: 14px; height: 14px; width: 14px;">schedule</mat-icon>
                      <span>{{record.timestamp | date:'shortTime'}}</span>
                    </div>
                  </div>
                  
                  <!-- Historical badge -->
                  <div *ngIf="record.isHistorical" style="margin-top: 4px;">
                    <mat-chip color="accent">
                      <mat-icon style="font-size: 14px; height: 14px; width: 14px; margin-right: 4px;">calendar_today</mat-icon>
                      {{record.historicalDate}}
                    </mat-chip>
                  </div>
                </div>
              </div>
            </mat-list-item>
            <mat-divider *ngIf="i < conversionHistory.length - 1"></mat-divider>
          </ng-container>
        </mat-list>

        <ng-template #emptyHistory>
          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center; color: rgba(0,0,0,0.6);">
            <mat-icon style="font-size: 64px; height: 64px; width: 64px; margin-bottom: 16px; color: #e0e0e0;">receipt_long</mat-icon>
            <h3 style="margin: 0 0 8px 0; color: rgba(0,0,0,0.6);">No Conversion History</h3>
            <p style="margin: 0 0 20px 0; font-size: 0.875rem;">Your conversions will appear here</p>
            <button mat-stroked-button color="primary" (click)="convertCurrency()">
              <mat-icon>add</mat-icon>
              Make First Conversion
            </button>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<!-- Info Panel -->
<mat-card style="margin-top: 24px;">
  <mat-card-header>
    <mat-icon mat-card-avatar style="color: #f57c00;">info</mat-icon>
    <mat-card-title>How to Use</mat-card-title>
    <mat-card-subtitle>Quick guide for currency conversion</mat-card-subtitle>
  </mat-card-header>
  
  <mat-divider></mat-divider>

  <mat-card-content>
    <mat-grid-list cols="3" rowHeight="100px" gutterSize="16px">
      <mat-grid-tile>
        <div style="display: flex; align-items: center; gap: 16px; padding: 16px;">
          <mat-icon style="font-size: 40px; height: 40px; width: 40px; color: #1976d2;">date_range</mat-icon>
          <div>
            <div style="font-weight: 500; margin-bottom: 4px;">Historical Rates</div>
            <div style="font-size: 0.875rem; color: rgba(0,0,0,0.6);">Select any date to view historical exchange rates</div>
          </div>
        </div>
      </mat-grid-tile>
      
      <mat-grid-tile>
        <div style="display: flex; align-items: center; gap: 16px; padding: 16px;">
          <mat-icon style="font-size: 40px; height: 40px; width: 40px; color: #2e7d32;">swap_horiz</mat-icon>
          <div>
            <div style="font-weight: 500; margin-bottom: 4px;">Quick Swap</div>
            <div style="font-size: 0.875rem; color: rgba(0,0,0,0.6);">Click the swap button to reverse currencies instantly</div>
          </div>
        </div>
      </mat-grid-tile>
      
      <mat-grid-tile>
        <div style="display: flex; align-items: center; gap: 16px; padding: 16px;">
          <mat-icon style="font-size: 40px; height: 40px; width: 40px; color: #7b1fa2;">save</mat-icon>
          <div>
            <div style="font-weight: 500; margin-bottom: 4px;">Save History</div>
            <div style="font-size: 0.875rem; color: rgba(0,0,0,0.6);">All conversions are saved locally in your browser</div>
          </div>
        </div>
      </mat-grid-tile>
    </mat-grid-list>
  </mat-card-content>
</mat-card>